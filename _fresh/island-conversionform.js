import{a as g}from"./chunk-HEHPRFYX.js";import{a as x}from"./chunk-GWM7M5Y5.js";import{a as e}from"./chunk-BYRZ2NRM.js";import{a}from"./chunk-EX6SY4DB.js";import{d as b}from"./chunk-JP5XG2OT.js";var T=[{value:"epub",label:"EPUB",accept:".epub"},{value:"mobi",label:"MOBI",accept:".mobi"},{value:"pdf",label:"PDF",accept:".pdf"},{value:"txt",label:"TXT",accept:".txt"}];function U(){let[s,y]=a(null),[c,h]=a("epub"),[l,u]=a(!1),[p,n]=a(""),[f,m]=a(""),w=t=>{if(t.size>52428800){n("\u6587\u4EF6\u5927\u5C0F\u8D85\u8FC7\u9650\u5236\uFF08\u6700\u592750MB\uFF09");return}y(t),n(""),m("")},F=t=>{let o=t.target;h(o.value)},v=()=>s?s.name.split(".").pop()?.toLowerCase():null,S=()=>{if(!s)return;let t={id:crypto.randomUUID(),fileName:s.name,sourceFormat:v()||"",targetFormat:c,timestamp:Date.now()},o=localStorage.getItem("conversionHistory"),r=[];if(o)try{r=JSON.parse(o)}catch(d){console.error("\u89E3\u6790\u5386\u53F2\u8BB0\u5F55\u5931\u8D25:",d)}r=[t,...r].slice(0,10),localStorage.setItem("conversionHistory",JSON.stringify(r))},C=async t=>{if(t.preventDefault(),!s){n("\u8BF7\u5148\u9009\u62E9\u4E00\u4E2A\u6587\u4EF6");return}u(!0),n(""),m("");try{let o=new FormData;o.append("file",s),o.append("targetFormat",c);let r=await fetch("/api/convert",{method:"POST",body:o});if(!r.ok){let I=await r.json();throw new Error(I.message||"\u8F6C\u6362\u5931\u8D25")}let d=await r.blob(),k=URL.createObjectURL(d),i=document.createElement("a"),D=c.toLowerCase(),H=s.name.split(".")[0]+"."+D;i.href=k,i.download=H,document.body.appendChild(i),i.click(),document.body.removeChild(i),S(),m("\u8F6C\u6362\u6210\u529F\uFF01\u6587\u4EF6\u5DF2\u5F00\u59CB\u4E0B\u8F7D\u3002")}catch(o){n(o instanceof Error?o.message:"\u8F6C\u6362\u8FC7\u7A0B\u4E2D\u53D1\u751F\u9519\u8BEF")}finally{u(!1)}},E=T.filter(t=>t.value!==v());return e("form",{onSubmit:C,class:"space-y-6",children:[e("div",{children:[e("label",{class:"block text-sm font-medium text-gray-700 mb-2",children:"\u9009\u62E9\u6587\u4EF6"}),e(g,{onFileSelect:w,accept:".epub,.mobi,.pdf,.txt"})]}),s&&e("div",{children:[e("label",{htmlFor:"format",class:"block text-sm font-medium text-gray-700 mb-2",children:"\u8F6C\u6362\u4E3A"}),e("select",{id:"format",value:c,onChange:F,class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-primary focus:border-primary sm:text-sm rounded-md",children:E.map(t=>e("option",{value:t.value,children:t.label},t.value))})]}),p&&e("div",{class:"rounded-md bg-red-50 p-4",children:e("div",{class:"flex",children:e("div",{class:"ml-3",children:[e("h3",{class:"text-sm font-medium text-red-800",children:"\u9519\u8BEF"}),e("div",{class:"mt-2 text-sm text-red-700",children:e("p",{children:p})})]})})}),f&&e("div",{class:"rounded-md bg-green-50 p-4",children:e("div",{class:"flex",children:e("div",{class:"ml-3",children:[e("h3",{class:"text-sm font-medium text-green-800",children:"\u6210\u529F"}),e("div",{class:"mt-2 text-sm text-green-700",children:e("p",{children:f})})]})})}),e("div",{children:e("button",{type:"submit",disabled:!s||l,class:`w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${!s||l?"bg-gray-400 cursor-not-allowed":"bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"}`,children:l?e(b,{children:[e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"\u6B63\u5728\u8F6C\u6362..."]}):"\u5F00\u59CB\u8F6C\u6362"})}),l&&e("div",{class:"mt-4",children:[e(x,{isActive:l,duration:8e3}),e("p",{class:"text-sm text-center text-gray-600",children:"\u6B63\u5728\u8F6C\u6362\uFF0C\u8BF7\u7A0D\u5019..."})]})]})}export{U as default};
